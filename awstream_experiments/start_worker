#!/usr/bin/env bash

JS=`dirname $0`/..
export LD_LIBRARY_PATH=${JS}/lib
CFG="-C worker.conf"
PID_DIR=/tmp/jetstream
LOGNAME=/tmp/jetstream.log

if [ -f ${PID_DIR}/jsnode.pid ]; then
  echo "Killing previous run"
  kill `cat ${PID_DIR}/jsnode.pid`
fi

CMD="${JS}/jsnoded --start ${CFG}"

echo "logging to ${LOGNAME}; libpath is ${LD_LIBRARY_PATH}"
echo "running ${CMD}"
nohup ${CMD} $@ >$LOGNAME 2>&1 &
PID=$!
echo $PID > ${PID_DIR}/jsnode.pid
echo "started; pid is ${PID}"
sleep 1
